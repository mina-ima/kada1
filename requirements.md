要件定義書（Ver1＋Ver2ロードマップ付き）

1. 概要
•アプリ名：年齢・和暦変換ツール
•目的：社内業務で頻出の生年月日処理を高速・正確に行う（和暦⇔西暦変換、年齢算出）。将来は勤続年数・定年までの期間・退職所得控除計算まで拡張。
•公開形態：インターネット公開（個人情報は保存しない）
•デプロイ：Vercel（https://wareki-age.vercel.app）
•技術：React + TypeScript（Vite）／Tailwind。計算はブラウザ内完結（サーバーレス）。

2. スコープ

Ver1（今回）
•入力：生年月日、基準日（任意・未入力は日本時間の「今日」）
•変換：昭和・平成・令和の和暦⇔西暦
•計算：満年齢（基準日基準、デフォルトは今日）
•表示：西暦（例：1990年1月1日）、和暦（漢字フル＋元年表記：例「令和元年5月1日」）、年齢（例：35歳）
•UI：1人分のフォーム型、入力はピッカー＋キーボード両対応
•例示テキスト：例：R1/5/1, H31-4-30, S45.12.3, 1990/01/01
•エラー文言（確定）
1.不正日付：日付が正しくありません。形式を確認してください。
2.未来日：未来の日付は指定できません。
3.対象外元号：対象外の元号です（昭和・平成・令和のみ対応）。
4.和暦略号ミス：和暦は S/H/R の略号で入力してください。
5.範囲外：該当する和暦/西暦の範囲にありません。

Ver2（次サイクル）
•勤続年数：年・月・日で表示（端数そのまま）
•定年までの期間：
•入力：定年到達年齢X（初期値60）
•ルール選択：①X歳誕生日 ②X歳誕生月末 ③X歳到達年度末（3/31）
•出力：定年退職日／基準日からの残期間（年・月・日）
•退職所得（簡易）：
•入力：退職金額、勤続年数（自動連携 or 手入力）
•退職所得控除：
•20年以下：40万円×勤続年数（最低80万円）
•20年超：800万円＋70万円×（勤続年数−20年）
•退職所得＝（退職金額−控除額）÷2（マイナスは0）
•出力：表形式（税額計算は対象外）

3. 非スコープ（Ver1）
•CSV/PDF出力、データ保存、ログイン、税額算出（所得税・住民税）、大正・明治の対応、複数人一括入力。

4. 入力仕様（Ver1）
•西暦：yyyy/m/d（-、.、スペースも許容）
•和暦：略号＋数字のみ（①対応）。S|H|R、元年は1年と同義（④対応）、/ - . スペース セパレータ許容（⑤対応）、ゼロ埋め可（⑥対応、例：R01/05/01）
•元号境界（厳密）：
•昭和：1926-12-25 ～ 1989-01-07
•平成：1989-01-08 ～ 2019-04-30
•令和：2019-05-01 ～（現在）
•バリデーションポリシー：
•不正日付・対象外元号・未来日はエラー（丸めなし）
•境界日は厳密に判定（例：1989/1/7＝昭和、1/8＝平成）

5. 出力仕様（Ver1）
•西暦：YYYY年M月D日（ゼロ埋めなし、日本語）
•和暦：漢字フル＋元年表記（例：令和元年5月1日）
•年齢：N歳

6. 画面仕様（Ver1）
•青系テーマ（ヘッダー/フッター濃紺、ボタンは青系）
•入力2フィールド（生年月日・基準日）＋「計算する」ボタン
•入力下に例示固定表示、エラーは各入力直下に赤文字
•結果はカード表示（西暦・和暦・年齢）
•キーボード操作：Tab順最適化／Enterで計算

7. コンポーネント／構成
•components: Header, Footer, DateInputField, ResultCard, ErrorText
•features/birthdate: BirthdateForm, useBirthdateCalc
•lib/date: eras.ts, parseWareki.ts, formatWareki.ts, parseGregorian.ts, age.ts, validate.ts, utils.ts
•tests/date: 単体テスト一式

8. 品質・非機能
•パフォーマンス：初回ロード軽量、依存最小
•アクセシビリティ：ラベル関連付け、エラー説明、フォーカス制御
•セキュリティ：入力はブラウザ内のみ処理、保存しない
•対応ブラウザ：最新のChrome/Edge/Firefox/Safari

9. 受け入れ基準（Ver1）
•指定入力例は全て受理し正しく計算できる
•元号境界3点（1989/1/7, 1/8, 2019/5/1）が正しく判定
•未来日・不正日付は明確なエラー表示
•和暦出力の元年表記が正しく表示
•主要ブラウザで正常動作

10. リスクと対策
•日付ロジックの落とし穴：境界・閏年のテストを網羅
•ブラウザ差：E2Eチェック
•スコープ過多：Ver1に集中、Ver2は次サイクル
